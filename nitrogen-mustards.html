<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nitrogen Mustards Mechanism</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
        width: 100%;
        height: 100%;
        font-family: 'Arial', sans-serif;
        color: #333;
        line-height: 1.6;
        scroll-behavior: smooth;
        background: #f5f7fa;
        }

        body {
            overflow-x: hidden;
            overflow-y: auto;
            margin: 0;
        }

        /* Sidebar Styles */
        .sidebar-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #1a2980;
            border-radius: 50%;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            background-color: rgba(255, 255, 255, 1);
            transform: scale(1.1);
        }
        
        .sidebar-toggle-icon {
            font-size: 20px;
            color: white;
        }
        
        /* WHITE SIDEBAR STYLES */
        .sidebar {
            width: 280px;
            background: white;
            color: #333;
            padding: 30px 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 999;
            left: -280px;
            top: 0;
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.05);
            border-right: 1px solid #eee;
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .sidebar h2 {
            color: #1a2980;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            font-size: 1.5rem;
        }
        
        /* Navigation Links */
        .nav-links {
            list-style: none;
            padding: 0;
        }
        
        .nav-links li {
            margin-bottom: 10px;
        }
        
        .nav-links a {
            color: #555;
            text-decoration: none;
            display: block;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover {
            background: rgba(26, 41, 128, 0.1);
            color: var(--primary-color);
        }

        /* Submenu Styles */
        .sub-links {
            list-style: none;
            padding-left: 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .has-submenu.active .sub-links {
            max-height: 500px;
        }

        .sub-links a {
            padding: 8px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        .sub-links a:hover {
            background-color: #f8f9fa;
        }

        .has-submenu {
            position: relative;
        }

        .has-submenu::after {
            content: '▼';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            transition: transform 0.3s ease;
            color: var(--primary-color);
        }

        .has-submenu.active::after {
            transform: translateY(-50%) rotate(180deg);
        }

        
        /* Main Content Styles */
        .scene {
            min-height: auto;
            height:auto;
            padding: 80px 40px;
            margin-bottom: 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            max-width: 1000px;
            margin: 60px auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: visible;
        }

        .header {
            text-align: center;
            padding: 80px 20px 60px;
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: white;
            position: relative;
            z-index: 10;
            clip-path: polygon(0 0, 100% 0, 100% 90%, 0 100%);
            margin-bottom: -30px;
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.9;
        }

        .scene h2 {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-size: 1.8rem;
            position: relative;
            padding-bottom: 10px;
        }

        .scene h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .scene p {
            margin-bottom: 15px;
            line-height: 1.7;
        }

        /* Mechanism Visualization Styles */
        .mechanism-visualization {
    transform-origin: center center;
    transition: transform 0.3s;
    overflow-x: auto; /* allows horizontal scroll if needed */

    display: flex;
    justify-content: center;
    align-items: center;
    margin: 30px 0;
    background: rgba(245, 245, 245, 0.5);
    border-radius: 10px;
    padding: 20px;
    border: 1px solid #eee;
}

.legend {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 18px;
  margin: 20px 0;
  padding: 15px;
  background: rgba(245, 245, 245, 0.8);
  border-radius: 8px;
  overflow-x: auto;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
}

.legend-color {
  width: 20px;
  height: 20px;
  border-radius: 5px;
  margin-right: 8px;
  border: 1.5px solid #bbb;
  display: inline-block;
  /* background is set inline in HTML */
}
        .explanation-box {
            background: rgba(245, 245, 245, 0.8);
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid var(--primary-color);
            transition: all 0.3s ease;
        }

        .explanation-box h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .explanation-text {
            line-height: 1.7;
        }

        .navigation-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
    }
    
    .navigation-buttons button {
        padding: 12px 24px;
        border: none;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .navigation-buttons button:nth-child(1),
    .navigation-buttons button:nth-child(2) {
        background: linear-gradient(135deg, #1a2980, #26d0ce);
        color: white;
    }
    
    .navigation-buttons button:last-child {
        background: linear-gradient(135deg, #ff416c, #ff4b2b);
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .navigation-buttons button:last-child::after {
        content: '↻';
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 18px;
    }
    
    .navigation-buttons button:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    
    .navigation-buttons button:active {
        transform: translateY(1px);
    }
    
    .navigation-buttons button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
    }

        /* Scientific Highlight Styles */
        .key-points, .activation-pathway {
            background: rgba(245, 245, 245, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid var(--primary-color);
        }

        .key-points h3, .activation-pathway h3 {
            margin-bottom: 15px;
        }

        .key-points ul, .activation-pathway ol {
            padding-left: 20px;
        }

        .key-points li, .activation-pathway li {
            margin-bottom: 10px;
        }

        .comparison-table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .comparison-table th, .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .comparison-table th {
            background-color: var(--primary-color);
            color: white;
        }

        .comparison-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .comparison-table tr:hover {
            background-color: rgba(26, 41, 128, 0.05);
        }

        .molecular-detail {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid #eee;
        }

        .nitrogen-mustard-highlight {
            background-color: rgba(138, 43, 226, 0.1);
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            border-radius: 0 5px 5px 0;
            margin: 15px 0;
        }

        /* Animation Tooltip */
        .animation-tooltip {
            position: absolute;
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            z-index: 10000;
            white-space: nowrap;
            transform: translate(-50%, -110%);
            font-family: 'Roboto', sans-serif;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
            }
            
            .header {
                padding: 80px 20px 60px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .header p {
                font-size: 1.1rem;
            }
            
            .scene {
                padding: 40px 25px;
                margin: 40px 20px;
            }
            
            .scene h2 {
                font-size: 1.5rem;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation-buttons button {
                width: 100%;
            }
        }

        @media (max-width: 576px) {
            .header {
                padding: 60px 20px 40px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .scene {
                padding: 30px 20px;
                margin: 30px 15px;
            }
            
            .legend {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .explanation-box {
                padding: 20px 15px;
            }
        }

        /* Animations */
        @keyframes highlight {
            from { background-color: var(--highlight-color); }
            to { background-color: transparent; }
        }

        :target {
            animation: highlight 2s ease;
        }

        /* Chemistry Specific Styles */
        .chemical-structure {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .chemical-formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.2rem;
            color: var(--primary-color);
            margin: 15px 0;
        }

        .molecular-weight {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }


.scene.chemistry-theme {
            width: 100%;
            padding: 2rem;
            background: 
                url('https://www.transparenttextures.com/patterns/hexellence.png') repeat,
                linear-gradient(135deg, #f0f8ff 0%, #e0f7fa 100%);
            background-blend-mode: overlay;
            box-shadow: inset 0 0 0 1000px rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(4px);
            border-top: 6px solid #4db6ac;
            border-bottom: 6px solid #4db6ac;
            box-sizing: border-box;

            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            align-items: center; /* ✅ Center content vertically */
            justify-content: center;
        }

        .source-caption {
            text-align: center;
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 1.5rem;
        }

        .main-caption {
            text-align: center;
            font-weight: 600;
            font-size: 1.2rem;
            color: #00796b;
            margin-top: 1rem;
        }

        #img2 {
      display: none;
      margin-top: 10px;
    }

    img {
      cursor: pointer;
      max-width: 200px;
    }

    .scene img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            display: block;
            margin: 0 auto;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

    .navigation-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
    }
    
    .navigation-buttons button {
        padding: 12px 24px;
        border: none;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .navigation-buttons button:nth-child(1),
    .navigation-buttons button:nth-child(2) {
        background: linear-gradient(135deg, #1a2980, #26d0ce);
        color: white;
    }
    
    .navigation-buttons button:last-child {
        background: linear-gradient(135deg, #ff416c, #ff4b2b);
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .navigation-buttons button:last-child::after {
        content: '↻';
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 18px;
    }
    
    .navigation-buttons button:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    
    .navigation-buttons button:active {
        transform: translateY(1px);
    }
    
    .navigation-buttons button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
    }

    .mechanism-visualization {
            height: 400px;
            position: relative;
            margin: 30px 0;
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            border: 1px solid #eee;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .mechanism-visualization::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="1" height="1" fill="%23eee"/></svg>');
            opacity: 0.3;
        }
        
        .molecule-label {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transform: translate(-50%, -50%);
        }
        
        .dna-strand {
            position: absolute;
            width: 300px;
            height: 60px;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 30px;
            opacity: 0;
            transform: scale(0.8);
        }
        
        .blood-brain-barrier {
            position: absolute;
            width: 100%;
            height: 3px;
            background: #1a2980;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            opacity: 0.7;
        }

        .mechanism-flex-row {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 32px;
    justify-content: center;
    margin-bottom: 30px;
}

.mechanism-visualization {
    min-width: 440px;
    /* Keep your existing .mechanism-visualization styles here */
}

.navigation-buttons {
    display: flex;
    flex-direction: column;
    align-items: stretch;
    gap: 16px;
    margin: 0;
    min-width: 180px;
    max-width: 200px;
}

@media (max-width: 900px) {
    .mechanism-flex-row {
        flex-direction: column;
        gap: 15px;
        align-items: stretch;
    }
    .navigation-buttons {
        flex-direction: row;
        margin-top: 20px;
        min-width: 0;
        max-width: none;
        justify-content: center;
    }
}

    </style>
</head>

<body>
    <!-- Sidebar Toggle Button -->
    <div class="sidebar-toggle" id="sidebarToggle">
        <span class="sidebar-toggle-icon">☰</span>
    </div>

    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul class="nav-links">
            <li><a href="historical.html">Warhead and Wonder drugs</a></li>
            <li><a href="mechanism.html">Cellular blueprints</a></li>
            <li class="has-submenu">
                <a href="agents.html">Weapons of the cell war</a>
                <ul class="sub-links">
                  <li><a href="agents.html">Summary</a></li>
                  <li><a href="nitrogen-mustards.html">Nitrogen Mustards</a></li>
                  <li><a href="oxazaphosphorines.html">Oxazaphosphorines</a></li>
                  <li><a href="mitomycin-c.html">Mitomycin C</a></li>
                  <li><a href="nitrosoureas.html">Nitrosourea</a></li>
                </ul>
              </li>
            <li><a href="references.html">References</a></li>
            <li><a href="index.html">Authors</a></li>
        </ul>
    </div>
    <!-- Main Header -->
    <div class="header">
        <h1>From Mustard Gas to Chemotherapy</h1>
        <p>From chemical warfare to cancer cure, the alchemical evolution of chemotherapy drugs</p>
    </div>

    <div class="scene">
        <h2>Nitrogen Mustards</h2>
    </div>

    
    <div class="scene chemistry-theme">
        <figure>

            <img id="img1" src="nitrogen-mustard1.png" alt="Nitrogen Mustard 1">
            <img id="img2" src="nitrogen-mustard2.png" alt="Nitrogen Mustard 2">
            <figcaption class="main-caption">Nitrogen Mustard Activation Pathway</figcaption>
            <figcaption class="source-caption">
                <i>Credit to Polavarapu, A., Stillabower, J. A., Stubblefield, S. G. W., Taylor, W. M., & Baik, M. H. (2012). The mechanism of guanine alkylation by nitrogen mustards: A computational study. Journal of Organic Chemistry, 77(14), 5914–5921. </i>
    
            </figcaption>
        </figure>
        <p class="description">
            The helicase binds tightly to one DNA strand, and as it translocates forward, it pulls that strand.
            This causes the complementary strand to be physically pushed away as base pairing is disrupted.
            The separation destabilizes the nucleotide base pairs, causing them to preferentially separate.
        </p>
    </div>

    <div class="scene chemistry-theme">
        <figure>

            <img src="https://basicmedicalkey.com/wp-content/uploads/2017/04/image02614.jpeg" alt="Nitrogen Mustard3">
            <!--<figcaption class="main-caption">Nitrogen Mustard Activation Pathway</figcaption>-->
            <figcaption class="source-caption">
                <i>Credit to Kumar, V., Abbas, A. K., & Aster, J. C. (2015). Robbins and Cotran pathologic basis of disease (9th ed.). Elsevier.  </i>
            </figcaption>
        </figure>
        <p class="description">
            <ul>
            <li>Aziridinium ion will form a <strong>strong covalent bond between the two strands of DNA</strong>, or more commonly known as interstrand cross-linkage.</li>

            <li>The linkage <strong>prevents the helicase</strong> from separating the two strands apart.</li>
            
            <li>This <strong>halts the α-Polymerase</strong> from making a complete set of Okazaki fragments.</li>
            
            <li>DNA Replication fails</li>
            </ul>
            
        </p>
    </div>

    <div class="scene" id="nitrogen-mustard-mechanism">
        <h2>Nitrogen Mustard Animation</h2>
        <div class="mechanism-flex-row">
            <div class="mechanism-visualization">
                <svg id="nm-animation" width="500" height="400" viewBox="0 0 780 400">
                    <g id="nm-zoom-group" transform="scale(1.5) translate(-140, -95)">
                        <g id="initial-dna-container"></g>
                        <g id="nm-molecule" opacity="0">
                            <circle cx="400" cy="250" r="20" fill="#8A2BE2" stroke="#6A0DAD" stroke-width="2" id="nm-circle"></circle>
                            <text x="400" y="255" text-anchor="middle" fill="white" font-size="12px" font-weight="bold">NM</text>
                            <rect x="380" y="270" width="40" height="20" fill="#8A2BE2" rx="5" ry="5"></rect>
                            <text x="400" y="285" text-anchor="middle" fill="white" font-size="8px">CH2CH2Cl</text>
                            <rect x="380" y="220" width="40" height="20" fill="#8A2BE2" rx="5" ry="5"></rect>
                            <text x="400" y="235" text-anchor="middle" fill="white" font-size="8px">CH2CH2Cl</text>
                        </g>
                        <g id="aziridinium-ion" opacity="0">
                            <rect x="345" y="230" width="110" height="40" rx="20" ry="20"
                                  fill="#FFA500" stroke="#FF8C00" stroke-width="2"/>
                            <text x="400" y="255" text-anchor="middle" fill="white" font-size="18px" font-weight="bold">Aziridinium</text>
                        </g>
                        <g id="cross-link-formation" opacity="0">
                            <line id="cross-link-line" x1="0" y1="0" x2="0" y2="0" stroke="#8A2BE2" stroke-width="4"></line>
                        </g>
                    </g>
                </svg>
                <div class="animation-tooltip"></div>
            </div>
            <div class="navigation-buttons">
                <button id="nm-prev-btn">Previous</button>
                <button id="nm-next-btn">Next</button>
                <button id="nm-restart-btn">Restart</button>
            </div>
        </div>
        <div class="legend">
            <div class="legend-item"><div class="legend-color" style="background: #007bff;"></div><span>5'-3' Backbone (Blue)</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #dc3545;"></div><span>3'-5' Backbone (Red)</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #F08080;"></div><span>Adenine (A)</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #F5D67D;"></div><span>Thymine (T)</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #58D68D;"></div><span>Guanine (G)</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #5DADE2;"></div><span>Cytosine (C)</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #BDC3C7;"></div><span>Hydrogen Bonds</span></div>
          </div>
        <div class="explanation-box">
            <h3 id="nm-step-title"></h3>
            <p class="explanation-text" id="nm-explanation"></p>
        </div>
    </div>

    <div class="scene chemistry-theme">
        <figure>

            <img src="https://petcancersociety.com/wp-content/uploads/mechlorethamine-2-400.png" alt="Mechlorethamine">
            <figcaption class="main-caption">Mechlorethamine</figcaption>
            <figcaption class="source-caption">
                <i>Credit to Pet Cancer Society. (n.d.). [Image of mechlorethamine chemical structure]. Pet Cancer Society.</i>
            </figcaption>
        </figure>
        <p class="description">
            <ul>
            <li>Drugs that are under the Nitrogen Mustard class include Mechlorethamine</li>

            <li>It targets lymphomas, breast carcinoma and solid tumors</li>
            
            </ul>
            
        </p>
    </div>
    
    <!-- Scientific Content Section -->
    <div class="scene">
        <h2>Nitrogen Mustards: Biochemical Mechanism</h2>
        
        <div class="key-points">
            <h3>Key Features of Nitrogen Mustards</h3>
            <ul>
                <li>Bifunctional alkylating agents with two reactive chloroethyl groups</li>
                <li>Form highly reactive aziridinium intermediates via intramolecular cyclization</li>
                <li>Primarily target the N7 position of guanine in DNA (most nucleophilic site)</li>
                <li>Create interstrand cross-links (8-9Å spacing) that block DNA replication</li>
                <li>Cross-links preferentially form at 5'-GNC-3' sequences (N = any base)</li>
            </ul>
        </div>
        
        <p>Nitrogen mustards are a class of bifunctional alkylating agents that exert their cytotoxic effects through covalent modification of DNA. The mechanism involves several distinct steps:</p>
        
        <div class="activation-pathway">
            <h3>Activation Pathway</h3>
            <ol>
                <li><strong>Intramolecular cyclization:</strong> The nitrogen mustard undergoes spontaneous intramolecular cyclization (SN2 reaction) to form an electrophilic aziridinium ion, with chloride as the leaving group.</li>
                <li><strong>Nucleophilic attack:</strong> The N7 position of guanine (pKa ~3.5), being highly nucleophilic due to its lone pair of electrons in the major groove, attacks the aziridinium ion (rate-limiting step).</li>
                <li><strong>Covalent bonding:</strong> Formation of a stable monoadduct via alkylation at N7 of guanine.</li>
                <li><strong>Second alkylation:</strong> The second chloroethyl arm undergoes similar activation, forming another aziridinium ion that reacts with a guanine on the opposite DNA strand.</li>
                <li><strong>Cross-link formation:</strong> Bifunctional adduct creates an interstrand cross-link (primarily between N7 positions of guanines).</li>
            </ol>
        </div>
        
        <div class="nitrogen-mustard-highlight">
            <p>The aziridinium ion is a highly strained three-membered ring structure (angle strain ~60°) that makes nitrogen mustards exceptionally reactive toward nucleophilic sites in DNA. The N7 position of guanine is particularly susceptible due to its location in the major groove and high electron density.</p>
        </div>
        
        <p>The bifunctional nature of nitrogen mustards allows them to form cross-links between two guanine residues, typically on opposite strands of the DNA double helix with an optimal spacing of 8-9Å. These interstrand cross-links prevent strand separation during DNA replication, effectively halting the replication process and triggering apoptotic pathways through the DNA damage response system.</p>
        
        <div class="molecular-detail">
            <h3>Structural Determinants of Cross-Linking</h3>
            <p>The efficiency of cross-link formation depends on several factors:</p>
            <ul>
                <li><strong>Distance between reactive centers:</strong> The ~8-9Å spacing between chloroethyl groups matches the distance between N7 atoms of guanines in opposite strands.</li>
                <li><strong>Base sequence context:</strong> 5'-GNC-3' sequences are most susceptible due to optimal spatial alignment.</li>
                <li><strong>Steric accessibility:</strong> The N7 position of guanine is in the major groove, making it more accessible than other nucleophilic sites.</li>
                <li><strong>Electron density:</strong> The N7 lone pair has higher electron density than other potential targets (e.g., O6 of guanine).</li>
            </ul>
        </div>
    </div>

    <!-- Biological Consequences Section -->
    <div class="scene">
        <h2>Biological Consequences of Alkylation</h2>
        
        <p>The formation of interstrand cross-links by nitrogen mustards has profound biological consequences at the molecular, cellular, and tissue levels:</p>
        
        <div class="key-points">
            <h3>Molecular Effects</h3>
            <ul>
                <li><strong>DNA distortion:</strong> Cross-links cause significant helical distortion (~30° bend) and local denaturation.</li>
                <li><strong>Replication blockage:</strong> The cross-links prevent DNA strand separation, halting the replication fork.</li>
                <li><strong>Transcription inhibition:</strong> RNA polymerase cannot traverse the damaged DNA region.</li>
                <li><strong>Base pairing disruption:</strong> Alkylated guanine can mispair with thymine during replication.</li>
            </ul>
        </div>
        
        <div class="activation-pathway">
            <h3>Cellular Response Pathway</h3>
            <ol>
                <li><strong>Damage recognition:</strong> ATM/ATR kinases detect DNA damage and phosphorylate downstream targets.</li>
                <li><strong>Cell cycle arrest:</strong> p53 activation leads to G1/S or G2/M arrest via p21 induction.</li>
                <li><strong>Repair attempts:</strong> Nucleotide excision repair (NER) and homologous recombination (HR) pathways are activated.</li>
                <li><strong>Repair failure:</strong> Persistent cross-links overwhelm repair capacity (especially in rapidly dividing cells).</li>
                <li><strong>Apoptotic signaling:</strong> Mitochondrial outer membrane permeabilization releases cytochrome c.</li>
                <li><strong>Caspase activation:</strong> Cytochrome c binds with Apaf-1 to form the apoptosome, activating caspase-9.</li>
                <li><strong>Execution phase:</strong> Caspase cascade (3, 6, 7) mediates proteolytic cleavage of cellular components.</li>
            </ol>
        </div>
        
        <div class="molecular-detail">
            <h3>Clinical Implications</h3>
            <p>The therapeutic index of nitrogen mustards depends on several factors:</p>
            <ul>
                <li><strong>Proliferation rate:</strong> Rapidly dividing cells (cancer, immune, gut epithelium) are most sensitive.</li>
                <li><strong>Repair capacity:</strong> Cells with deficient DNA repair (e.g., BRCA mutations) show increased sensitivity.</li>
                <li><strong>Cell cycle phase:</strong> Greatest efficacy in late G1 and S phases when DNA is replicating.</li>
                <li><strong>Resistance mechanisms:</strong> Includes increased DNA repair, glutathione conjugation, and decreased drug uptake.</li>
            </ul>
        </div>
    </div>

<!-- GSAP Library (required for animation) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script>
/* === Sidebar Logic === */
document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.querySelector(".sidebar");
    const sidebarToggle = document.querySelector('.sidebar-toggle');
    const navLinks = document.querySelectorAll(".nav-links > li > a");
    const hasSubmenuItems = document.querySelectorAll('.has-submenu');
    const subLinks = document.querySelectorAll('.sub-links a');

    // Sidebar toggle logic
    if (sidebarToggle && sidebar) {
        sidebarToggle.addEventListener('click', function () {
            sidebar.classList.toggle('active');
            localStorage.setItem('sidebarExpanded', sidebar.classList.contains('active'));
        });

        // Restore state
        if (localStorage.getItem('sidebarExpanded') === 'true') {
            sidebar.classList.add('active');
        }
    }

    // Submenu toggle
    hasSubmenuItems.forEach(item => {
        const link = item.querySelector('a');
        if (link) {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                item.classList.toggle('active');
            });
        }
    });

    // Close sidebar when a submenu link is clicked
    subLinks.forEach(subLink => {
        subLink.addEventListener('click', () => {
            sidebar.classList.remove("active");
            localStorage.setItem('sidebarExpanded', 'false');
        });
    });

    // Close sidebar when a top-level (non-submenu) link is clicked
    navLinks.forEach(link => {
        link.addEventListener("click", () => {
            if (!link.parentElement.classList.contains('has-submenu')) {
                sidebar.classList.remove("active");
                localStorage.setItem('sidebarExpanded', 'false');
            }
        });
    });

/* === Nitrogen Mustard Animation Logic === */
const nmStepData = [
    { title: "Step 1: Initial DNA Structure", content: "The DNA double helix is shown with intact hydrogen bonds. Nitrogen mustard (NM) is not yet present." },
    { title: "Step 2: NM Approaches DNA", content: "Nitrogen mustard (NM) appears and moves toward the DNA, targeting guanine bases." },
    { title: "Step 3: Aziridinium Ion Formation", content: "NM undergoes intramolecular cyclization, forming a reactive aziridinium ion (orange pill-shaped label)." },
    { title: "Step 4: First Alkylation of Guanine (Monoadduct)", content: "The aziridinium ion is attacked by the N7 of a guanine base, forming a covalent (alkyl) bond—first adduct." },
    { title: "Step 5: Second Cyclization & Interstrand Cross-Link", content: "The second arm of NM cyclizes and alkylates a guanine on the opposite strand, creating an interstrand cross-link." },
    { title: "Step 6: Biological Blockage and Cell Death", content: "The cross-link distorts the DNA double helix, blocking replication and transcription. This triggers cell death (apoptosis)—the basis of NM’s anticancer action." }
];

let nmCurrentStep = 0;
const nmMaxSteps = nmStepData.length;
let nmDna, g1, g2, g1x, g1y, g2x, g2y;

function bringMoleculesToFront() {
    const zoomGroup = document.getElementById('nm-zoom-group');
    ['cross-link-formation', 'nm-molecule', 'aziridinium-ion'].forEach(id => {
        const g = document.getElementById(id);
        if (g && zoomGroup) zoomGroup.appendChild(g);
    });
}

function createLabel(group, x, y, txt, color="#fff", size="8px", weight="normal") {
    const t = document.createElementNS("http://www.w3.org/2000/svg", 'text');
    t.setAttribute('x', x);
    t.setAttribute('y', y);
    t.setAttribute('text-anchor', 'middle');
    t.setAttribute('font-size', size);
    t.setAttribute('fill', color);
    t.setAttribute('font-weight', weight);
    t.textContent = txt;
    group.appendChild(t);
    return t;
}

function createDNAStrands(svg, centerX, y0, h) {
    const group = document.createElementNS("http://www.w3.org/2000/svg", 'g');
    svg.appendChild(group);

    const amp = 40, freq = 0.025, step = 2;
    let dBlue = '', dRed = '';
    for (let y = y0; y <= y0 + h; y += step) {
        const x1 = centerX - amp * Math.cos(freq * (y-y0));
        const x2 = centerX + amp * Math.cos(freq * (y-y0));
        if (y === y0) { dBlue += `M${x1},${y}`; dRed += `M${x2},${y}`; }
        else { dBlue += ` L${x1},${y}`; dRed += ` L${x2},${y}`; }
    }
    const pathBlue = document.createElementNS("http://www.w3.org/2000/svg", 'path');
    pathBlue.setAttribute('d', dBlue); pathBlue.setAttribute('stroke', '#007bff');
    pathBlue.setAttribute('stroke-width', 5); pathBlue.setAttribute('fill', 'none');
    group.appendChild(pathBlue);
    const pathRed = document.createElementNS("http://www.w3.org/2000/svg", 'path');
    pathRed.setAttribute('d', dRed); pathRed.setAttribute('stroke', '#dc3545');
    pathRed.setAttribute('stroke-width', 5); pathRed.setAttribute('fill', 'none');
    group.appendChild(pathRed);

    createLabel(group, centerX-amp-18, y0, "5'");
    createLabel(group, centerX-amp-18, y0+h, "3'");
    createLabel(group, centerX+amp+18, y0, "3'");
    createLabel(group, centerX+amp+18, y0+h, "5'");

    const seq = ['A','T','G','C','G','T','A','C','A','G'];
    const ySpacing = h/(seq.length+1);
    let bases1=[], bases2=[], hBonds=[];
    for (let i=0; i<seq.length; i++) {
        const yb = y0 + (i+1)*ySpacing;
        const x1 = centerX - amp * Math.cos(freq*(yb-y0));
        const x2 = centerX + amp * Math.cos(freq*(yb-y0));
        let color1, color2, b1, b2;
        if (seq[i] === 'A') { color1="#F08080"; color2="#F5D67D"; b1='A'; b2='T'; }
        if (seq[i] === 'T') { color1="#F5D67D"; color2="#F08080"; b1='T'; b2='A'; }
        if (seq[i] === 'G') { color1="#58D68D"; color2="#5DADE2"; b1='G'; b2='C'; }
        if (seq[i] === 'C') { color1="#5DADE2"; color2="#58D68D"; b1='C'; b2='G'; }
        // Strand 1 base
        const rect1 = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
        rect1.setAttribute('x', x1-8); rect1.setAttribute('y', yb-5); rect1.setAttribute('width', 16); rect1.setAttribute('height', 10);
        rect1.setAttribute('fill', color1); rect1.setAttribute('rx', 2);
        group.appendChild(rect1);
        bases1.push({element:rect1, x:x1, y:yb, type:b1});
        createLabel(group, x1, yb+3, b1);
        // Strand 2 base
        const rect2 = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
        rect2.setAttribute('x', x2-8); rect2.setAttribute('y', yb-5); rect2.setAttribute('width', 16); rect2.setAttribute('height', 10);
        rect2.setAttribute('fill', color2); rect2.setAttribute('rx', 2);
        group.appendChild(rect2);
        bases2.push({element:rect2, x:x2, y:yb, type:b2});
        createLabel(group, x2, yb+3, b2);

        // H bond
        const bond = document.createElementNS("http://www.w3.org/2000/svg", 'line');
        bond.setAttribute('x1', x1+8); bond.setAttribute('y1', yb);
        bond.setAttribute('x2', x2-8); bond.setAttribute('y2', yb);
        bond.setAttribute('stroke', '#BDC3C7'); bond.setAttribute('stroke-width', 2);
        group.appendChild(bond);
        hBonds.push(bond);
    }
    return {group, pathBlue, pathRed, bases1, bases2, hBonds, amp, freq, y0, h, centerX, ySpacing};
}

function setAnimationStep(step) {
    // Hide all molecules and overlays by default
    gsap.set("#nm-molecule", {opacity: 0, x: 0, y: 0, scale: 1});
    gsap.set("#aziridinium-ion", {opacity: 0, x: 0, y: 0, scale: 1});
    gsap.set("#cross-link-formation", {opacity: 0});
    gsap.set("#cross-link-line", {opacity: 0}); // Hide the line unless needed

    gsap.set(nmDna.bases1.map(b=>b.element), {fill: null, y: 0});
    gsap.set(nmDna.bases2.map(b=>b.element), {fill: null, y: 0});
    gsap.set(nmDna.hBonds, {opacity: 1});
    gsap.set([nmDna.pathBlue, nmDna.pathRed], {clearProps: 'all'});

    g1 = nmDna.bases1.find(b => b.type === 'G');
    g2 = nmDna.bases2.slice().reverse().find(b => b.type === 'G');
    g1x = g1.x + 8; g1y = g1.y;
    g2x = g2.x - 8; g2y = g2.y;

    bringMoleculesToFront();

    switch (step) {
        case 0:
            // No molecules present
            break;
        case 1: // NM appears and moves to DNA
            let nmMol = document.getElementById('nm-molecule');
            if (!nmMol) {
                nmMol = document.createElementNS("http://www.w3.org/2000/svg", 'g');
                nmMol.setAttribute('id', 'nm-molecule');
                let c = document.createElementNS("http://www.w3.org/2000/svg", 'ellipse');
                c.setAttribute('cx', 0); c.setAttribute('cy', 0);
                c.setAttribute('rx', 24); c.setAttribute('ry', 14);
                c.setAttribute('fill', '#2c3e50');
                nmMol.appendChild(c);
                let txt = document.createElementNS("http://www.w3.org/2000/svg", 'text');
                txt.setAttribute('x', 0); txt.setAttribute('y', 5);
                txt.setAttribute('text-anchor', 'middle');
                txt.setAttribute('font-size', '13px');
                txt.setAttribute('fill', '#fff');
                txt.textContent = "NM";
                nmMol.appendChild(txt);
                document.getElementById('nm-zoom-group').appendChild(nmMol);
            }
            gsap.set(nmMol, {opacity: 1, x: g1x - 400, y: g1y - 280, scale: 0.8});
            gsap.to(nmMol, {duration: 1.2, x: g1x - 50, y: g1y - 10, ease: "power2.out"});
            break;
        case 2: // Aziridinium ion appears at NM's position and moves in
            let az = document.getElementById('aziridinium-ion');
            if (!az) {
                az = document.createElementNS("http://www.w3.org/2000/svg", 'g');
                az.setAttribute('id', 'aziridinium-ion');
                let c = document.createElementNS("http://www.w3.org/2000/svg", 'ellipse');
                c.setAttribute('cx', 0); c.setAttribute('cy', 0);
                c.setAttribute('rx', 18); c.setAttribute('ry', 10);
                c.setAttribute('fill', 'orange');
                az.appendChild(c);
                let txt = document.createElementNS("http://www.w3.org/2000/svg", 'text');
                txt.setAttribute('x', 0); txt.setAttribute('y', 4);
                txt.setAttribute('text-anchor', 'middle');
                txt.setAttribute('font-size', '12px');
                txt.setAttribute('fill', '#fff');
                txt.textContent = "Aziridinium";
                az.appendChild(txt);
                document.getElementById('nm-zoom-group').appendChild(az);
            }
            gsap.set(az, {opacity: 1, x: g1x - 400, y: g1y - 280, scale: 1});
            gsap.to(az, {duration: 1.2, x: g1x - 16, y: g1y - 6, ease: "power2.out"});
            break;
            case 3: // Highlight first guanine for alkylation (monoadduct)
            // Hide NM, show aziridinium at site
            gsap.set("#nm-molecule", {opacity: 0});
            let az3 = document.getElementById('aziridinium-ion');
            if (!az3) return;
            gsap.set(az3, {opacity: 1, x: g1x - 16, y: g1y - 6, scale: 1});
            // Highlight first guanine base
            gsap.to(g1.element, {fill: "#8A2BE2", duration: 0.5});
            break;

        case 4: // Draw cross-link to second guanine (interstrand)
            // Keep aziridinium visible and first guanine highlighted
            let az4 = document.getElementById('aziridinium-ion');
            if (az4) gsap.set(az4, {opacity: 1, x: g1x - 16, y: g1y - 6, scale: 1});
            gsap.to(g1.element, {fill: "#8A2BE2", duration: 0.5});
            gsap.to(g2.element, {fill: "#8A2BE2", duration: 0.5});

            // Draw cross-link line (if not present)
            let crossLink = document.getElementById('cross-link-line');
            if (!crossLink) {
                crossLink = document.createElementNS("http://www.w3.org/2000/svg", 'line');
                crossLink.setAttribute('id', 'cross-link-line');
                crossLink.setAttribute('stroke', '#D32F2F');
                crossLink.setAttribute('stroke-width', 6);
                crossLink.setAttribute('stroke-dasharray', '7,4');
                document.getElementById('nm-zoom-group').appendChild(crossLink);
            }
            crossLink.setAttribute('x1', g1x);
            crossLink.setAttribute('y1', g1y);
            crossLink.setAttribute('x2', g2x);
            crossLink.setAttribute('y2', g2y);
            gsap.set(crossLink, {opacity: 1});
            break;

        case 5: // DNA distortion and cell death
            // Distort the DNA between two guanines, keep cross-link visible
            let crossLink5 = document.getElementById('cross-link-line');
            if (crossLink5) gsap.set(crossLink5, {opacity: 1});
            gsap.to(g1.element, {fill: "#8A2BE2", y: g1.y - 6, duration: 0.5});
            gsap.to(g2.element, {fill: "#8A2BE2", y: g2.y - 6, duration: 0.5});

            // Re-draw the DNA with a bend between crosslinked points
            let dBlue = '', dRed = '';
            for (let y = nmDna.y0; y <= nmDna.y0 + nmDna.h; y += 2) {
                let bend = 0;
                if (y > g1y-24 && y < g2y+24) bend = -20 * Math.sin((y-g1y)/30);
                const x1b = nmDna.centerX - nmDna.amp * Math.cos(nmDna.freq * (y-nmDna.y0)) + bend;
                const x2b = nmDna.centerX + nmDna.amp * Math.cos(nmDna.freq * (y-nmDna.y0)) - bend;
                if (y === nmDna.y0) { dBlue += `M${x1b},${y}`; dRed += `M${x2b},${y}`; }
                else { dBlue += ` L${x1b},${y}`; dRed += ` L${x2b},${y}`; }
            }
            nmDna.pathBlue.setAttribute('d', dBlue);
            nmDna.pathRed.setAttribute('d', dRed);

            // Fade out H-bonds (DNA denaturation)
            gsap.to(nmDna.hBonds, {opacity: 0.2, duration: 0.7});
            // Optional: add "Cell Death" label
            let deathLabel = document.getElementById('cell-death-label');
            if (!deathLabel) {
                deathLabel = document.createElementNS("http://www.w3.org/2000/svg", 'text');
                deathLabel.setAttribute('id', 'cell-death-label');
                deathLabel.setAttribute('x', 700);
                deathLabel.setAttribute('y', 60);
                deathLabel.setAttribute('fill', '#D32F2F');
                deathLabel.setAttribute('font-size', '28px');
                deathLabel.setAttribute('font-weight', 'bold');
                deathLabel.textContent = "☠ Cell Death";
                document.getElementById('nm-zoom-group').appendChild(deathLabel);
            }
            gsap.set(deathLabel, {opacity: 1});
            break;

        case 6: // Fade out everything, show just "Cell Death"
            gsap.to("#nm-molecule", {opacity: 0, duration: 0.6});
            gsap.to("#aziridinium-ion", {opacity: 0, duration: 0.6});
            gsap.to("#cross-link-line", {opacity: 0.5, duration: 0.6});
            gsap.to(nmDna.bases1.map(b=>b.element), {opacity: 0.3, duration: 1});
            gsap.to(nmDna.bases2.map(b=>b.element), {opacity: 0.3, duration: 1});
            gsap.to([nmDna.pathBlue, nmDna.pathRed], {opacity: 0.3, duration: 1});
            let deathLabel6 = document.getElementById('cell-death-label');
            if (deathLabel6) gsap.set(deathLabel6, {opacity: 1});
            break;
    }
    document.getElementById('nm-step-title').innerText = nmStepData[step].title;
    document.getElementById('nm-explanation').innerText = nmStepData[step].content;
    document.getElementById('nm-prev-btn').disabled = (step === 0);
    document.getElementById('nm-next-btn').disabled = (step === nmMaxSteps - 1);
}

function initNitrogenMustardAnimation() {
    // Remove previous DNA
    const zoomGroup = document.getElementById('nm-zoom-group');
    zoomGroup.innerHTML = '';
    nmDna = createDNAStrands(zoomGroup, 400, 80, 300);
    bringMoleculesToFront();
    setAnimationStep(nmCurrentStep);
}

    // Nitrogen Mustard mechanism animation logic
    initNitrogenMustardAnimation();
    document.getElementById('nm-prev-btn').onclick = function() {
        if (nmCurrentStep > 0) {
            nmCurrentStep--;
            setAnimationStep(nmCurrentStep);
        }
    };
    document.getElementById('nm-next-btn').onclick = function() {
        if (nmCurrentStep < nmMaxSteps-1) {
            nmCurrentStep++;
            setAnimationStep(nmCurrentStep);
        }
    };
    document.getElementById('nm-restart-btn').onclick = function() {
        nmCurrentStep = 0;
        setAnimationStep(nmCurrentStep);
    };
});
</script>
